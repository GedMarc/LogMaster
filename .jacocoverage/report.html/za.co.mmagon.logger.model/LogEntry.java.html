<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
    <link rel="stylesheet" href="../.resources/report.css" type="text/css"/>
    <link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/>
    <title>LogEntry.java</title>
    <link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/>
    <script type="text/javascript" src="../.resources/prettify.js"></script>
</head>
<body onload="window['PR_TAB_WIDTH']=4;prettyPrint()">
<div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html"
                                                              class="el_session">Sessions</a></span><a
        href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;LogMaster&quot; (powered by JaCoCo
    from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">za.co.mmagon.logger.model</a> &gt; <span
        class="el_source">LogEntry.java</span></div>
<h1>LogEntry.java</h1>
<pre class="source lang-java linenums">/*
 * Copyright (C) 2017 Marc Magon
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
package za.co.mmagon.logger.model;

import java.io.IOException;
import java.io.PrintWriter;
import java.io.Serializable;
import java.io.StringWriter;
import java.text.SimpleDateFormat;
import java.util.*;
import java.util.logging.Level;
import java.util.logging.LogRecord;
import java.util.logging.Logger;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 * A default Log Entry
 *
 * @author GedMarc
 * @since Nov 22, 2016
 *
 */
public class LogEntry implements Serializable
{

    private static final long serialVersionUID = 1L;
    /**
     * The pattern for a property
     */
<span class="fc" id="L45">    private static final Pattern propertyPatten = Pattern.compile(&quot;\\[(.*?)\\]-\\[(.*?)\\];&quot;);</span>

    /**
     * The date of this log entry
     */
    private Date date;
    /**
     * The level of this log entry
     */
    private Level level;
    /**
     * The message of this log entry
     */
    private String message;
    /**
     * The properties of this log entry
     */
    private List&lt;LogProperty&gt; properties;
    /**
     * The actual data of this log entry
     */
    private Serializable data;
    /**
     * The date formatter of this log entry
     */
    private final SimpleDateFormat dateFormatter;
    /**
     * The original system id of this log entry for identification
     */
    private String originalSourceSystemID;

    /**
     * Constructs a new log entry
     */
    private LogEntry()
<span class="fc" id="L80">    {</span>
<span class="fc"
      id="L81">        this.dateFormatter = new SimpleDateFormat(&quot;yyyy-MM-dd'T'HH:mm:ss.SSSXXX&quot;);</span>

<span class="fc" id="L83">    }</span>

    /**
     * Constructs a new log entry with the given entry and level
     *
     * @param entry
     * @param level
     */
    @SuppressWarnings(&quot;&quot;)
    private LogEntry(String entry, Level level)
<span class="nc" id="L93">    {</span>
<span class="nc"
      id="L94">        this.dateFormatter = new SimpleDateFormat(&quot;yyyy-MM-dd'T'HH:mm:ss.SSSXXX&quot;);</span>
<span class="nc" id="L95">        setDate(new Date());</span>
<span class="nc" id="L96">        setLevel(level);</span>
<span class="nc" id="L97">        LogProperty props = LogProperty.newProperty(&quot;message&quot;, entry);</span>
<span class="nc" id="L98">        getProperties().add(props);</span>
<span class="nc" id="L99">    }</span>

    /**
     * Creates a new log entry with all global properties attached
     *
     * @return
     */
    public static LogEntry newEntry()
    {
<span class="fc" id="L108">        LogEntry entry = new LogEntry();</span>
<span class="fc" id="L109">        entry.setDate(new Date());</span>
<span class="fc" id="L110">        entry.setLevel(Level.INFO);</span>
<span class="fc" id="L111">        return entry;</span>
    }

    /**
     * Creates a new log entry with all global properties attached
     *
     * @param record A log record produced by java logging
     *
     * @return
     */
    public static LogEntry newEntry(LogRecord record)
    {
<span class="nc" id="L123">        LogEntry le = LogEntry.newEntry();</span>
<span class="nc" id="L124">        le.setLevel(record.getLevel());</span>

<span class="nc" id="L126">        Date d = new Date();</span>
<span class="nc" id="L127">        d.setTime(record.getMillis());</span>
<span class="nc" id="L128">        le.setDate(d);</span>

<span class="nc" id="L130">        le.getProperties().add(LogProperty.newProperty(&quot;Level&quot;, padRight(record.getLevel().getName(), 7)));</span>
<span class="nc" id="L131">        le.getProperties().add(LogProperty.newProperty(&quot;Date&quot;, le.dateFormatter.format(d)));</span>
<span class="nc" id="L132">        le.getProperties().add(LogProperty.newProperty(&quot;Message&quot;, record.getMessage()));</span>
<span class="nc" id="L133">        le.getProperties().add(LogProperty.newProperty(&quot;Name&quot;, record.getLoggerName()));</span>
<span class="nc" id="L134">        le.getProperties().add(LogProperty.newProperty(&quot;Class&quot;, record.getSourceClassName()));</span>
<span class="nc" id="L135">        le.getProperties().add(LogProperty.newProperty(&quot;Method&quot;, record.getSourceMethodName()));</span>
<span class="nc" id="L136">        Throwable thrown = record.getThrown();</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (thrown != null)</span>
        {
<span class="nc" id="L139">            StringWriter sw = new StringWriter();</span>
<span class="nc" id="L140">            try (PrintWriter pw = new PrintWriter(sw))</span>
            {
<span class="nc" id="L142">                thrown.printStackTrace(pw);</span>
<span class="nc" id="L143">                pw.flush();</span>
<span class="nc" id="L144">                String exceptionString = sw.toString();</span>
<span class="nc" id="L145">                le.getProperties().add(LogProperty.newProperty(&quot;Exception&quot;, exceptionString));</span>
<span class="nc bnc" id="L146" title="All 8 branches missed.">            }</span>
            try
            {
<span class="nc" id="L149">                sw.close();</span>
            }
<span class="nc" id="L151">            catch (IOException ex)</span>
            {
<span class="nc"
      id="L153">                Logger.getLogger(LogEntry.class.getName()).log(Level.SEVERE, null, ex);</span>
<span class="nc" id="L154">            }</span>
        }
<span class="nc" id="L156">        le.setMessage(record.getMessage());</span>
<span class="nc" id="L157">        return le;</span>
    }

    /**
     * Returns the date of this log entry
     *
     * @return
     */
    public Date getDate()
    {
<span class="fc" id="L167">        return date;</span>
    }

    /**
     * Sets the date of this log entry
     *
     * @param date
     *
     * @return
     */
    public LogEntry setDate(Date date)
    {
<span class="fc" id="L179">        this.date = date;</span>
<span class="fc" id="L180">        return this;</span>
    }

    /**
     * Gets the level of this log entry
     *
     * @return
     */
    public Level getLevel()
    {
<span class="fc" id="L190">        return level;</span>
    }

    /**
     * Sets the level of this log entry
     *
     * @param level
     *
     * @return
     */
    public LogEntry setLevel(Level level)
    {
<span class="fc" id="L202">        this.level = level;</span>
<span class="fc" id="L203">        return this;</span>
    }

    /**
     * *
     * Returns the properties of this log entry
     *
     * @return
     */
    public List&lt;LogProperty&gt; getProperties()
    {
<span class="fc bfc" id="L214" title="All 2 branches covered.">        if (properties == null)</span>
        {
<span class="fc" id="L216">            properties = new ArrayList&lt;&gt;();</span>
        }
<span class="fc" id="L218">        return properties;</span>
    }

    /**
     * Sets the properties of this log entry
     *
     * @param properties
     *
     * @return
     */
    public LogEntry setProperties(List&lt;LogProperty&gt; properties)
    {
<span class="nc" id="L230">        this.properties = properties;</span>
<span class="nc" id="L231">        return this;</span>
    }

    /**
     * Any attached object that you would want the data from
     *
     * @return
     */
    public Object getData()
    {
<span class="nc" id="L241">        return data;</span>
    }

    /**
     * Any attached object you would want to fetch data from
     *
     * @param data
     *
     * @return
     */
    public LogEntry setData(Serializable data)
    {
<span class="nc" id="L253">        this.data = data;</span>
<span class="nc" id="L254">        return this;</span>
    }

    /**
     * Returns the message for this log entry
     *
     * @return
     */
    public String getMessage()
    {
<span class="fc" id="L264">        return message;</span>
    }

    /**
     * Returns the message for this entry
     *
     * @param message
     *
     * @return
     */
    public LogEntry setMessage(String message)
    {
<span class="fc" id="L276">        this.message = message;</span>
<span class="fc" id="L277">        getPropertiesFromMessage(this.message).entrySet().forEach(entry -&gt;</span>
        {
<span class="nc" id="L279">            String key = entry.getKey();</span>
<span class="nc" id="L280">            String value = entry.getValue();</span>
<span class="nc" id="L281">            getProperties().add(LogProperty.newProperty(key, value));</span>
<span class="nc" id="L282">        });</span>
<span class="fc" id="L283">        getProperties().add(LogProperty.newProperty(&quot;Level&quot;, padRight(getLevel().getName(), 7)));</span>
<span class="fc" id="L284">        getProperties().add(LogProperty.newProperty(&quot;Date&quot;, dateFormatter.format(getDate())));</span>

<span class="fc" id="L286">        getProperties().add(LogProperty.newProperty(&quot;Message&quot;, message));</span>
<span class="fc" id="L287">        return this;</span>
    }

    /**
     * Returns the log entry with the square brackets
     *
     * @return
     */
    @Override
    public String toString()
    {
<span class="nc" id="L298">        StringBuilder sb = new StringBuilder(&quot;&quot;);</span>
<span class="nc bnc" id="L299" title="All 4 branches missed.">        if (getProperties().isEmpty() &amp;&amp; !getMessage().isEmpty())</span>
        {
<span class="nc" id="L301">            sb.append(&quot;[&quot;).append(padRight(getLevel().getName(), 7)).append(&quot;];[&quot;)</span>
<span class="nc" id="L302">                    .append(dateFormatter.format(getDate())).append(&quot;];&quot;);</span>
<span class="nc bnc" id="L303" title="All 2 branches missed.">            if (getData() != null)</span>
            {
<span class="nc"
      id="L305">                sb.append(&quot;;[Data]-[&quot;).append(getData()).append(&quot;];&quot;);</span>
            }
<span class="nc" id="L307">            sb.append(&quot;[&quot;).append(getMessage()).append(&quot;];&quot;);</span>
        }
<span class="nc bnc" id="L309" title="All 2 branches missed.">        else if (!getProperties().isEmpty())</span>
        {
<span class="nc" id="L311">            getProperties().forEach(sb::append);</span>
        }
<span class="nc" id="L313">        sb.append(&quot;&quot;);</span>
<span class="nc" id="L314">        return sb.toString();</span>
    }

    /**
     * The original source system id
     *
     * @return
     */
    public String getOriginalSourceSystemID()
    {
<span class="nc bnc" id="L324" title="All 2 branches missed.">        if (originalSourceSystemID == null)</span>
        {
<span class="nc" id="L326">            originalSourceSystemID = &quot;-&quot;;</span>
        }
<span class="nc" id="L328">        return originalSourceSystemID;</span>
    }

    /**
     * The original source system id
     *
     * @param originalSourceSystemID
     */
    public void setOriginalSourceSystemID(String originalSourceSystemID)
    {
<span class="nc" id="L338">        this.originalSourceSystemID = originalSourceSystemID;</span>
<span class="nc" id="L339">    }</span>

    /**
     * Is the parameter a message
     *
     * @return
     */
    private boolean isParameterMessage()
    {
<span class="fc" id="L348">        Matcher m = propertyPatten.matcher(message);</span>
<span class="pc bpc" id="L349" title="1 of 2 branches missed.">        return m.groupCount() &gt; 0;</span>
    }

    /**
     * Returns the properties map form this log entry
     *
     * @param message
     *
     * @return
     */
    public Map&lt;String, String&gt; getPropertiesFromMessage(String message)
    {
<span class="fc" id="L361">        Map&lt;String, String&gt; props = new HashMap&lt;&gt;();</span>
<span class="pc bpc" id="L362" title="1 of 2 branches missed.">        if (!isParameterMessage())</span>
        {
<span class="nc" id="L364">            return props;</span>
        }
<span class="fc" id="L366">        Matcher m = propertyPatten.matcher(message);</span>
<span class="pc bpc" id="L367" title="1 of 2 branches missed.">        while (m.find())</span>
        {
<span class="nc" id="L369">            props.put(m.group(1), m.group(2));</span>
        }
<span class="fc" id="L371">        return props;</span>
    }

    /**
     * Pads a property field or value by so many digits
     *
     * @param s the string
     * @param n number of digits
     *
     * @return
     */
    public static String padRight(String s, int n)
    {
<span class="fc" id="L384">        return String.format(&quot;%-&quot; + n + &quot;s&quot;, s);</span>
    }

    /**
     * Pads the property field or value by the number
     *
     * @param s the string
     * @param n the number of chars to
     *
     * @return
     */
    public static String padLeft(String s, int n)
    {
<span class="nc" id="L397">        return String.format(&quot;%1$&quot; + n + &quot;s&quot;, s);</span>
    }

    /**
     * Returns a specific log property
     *
     * @param name
     *
     * @return
     */
    public LogProperty getProperty(String name)
    {
<span class="nc bnc" id="L409" title="All 2 branches missed.">        for (LogProperty next : properties)</span>
        {
<span class="nc bnc" id="L411" title="All 2 branches missed.">            if (next.getPropertyName().equalsIgnoreCase(name))</span>
            {
<span class="nc" id="L413">                return next;</span>
            }
<span class="nc" id="L415">        }</span>
<span class="nc" id="L416">        return null;</span>
    }
}
</pre>
<div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span>
</div>
</body>
</html>